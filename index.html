<!DOCTYPE html>
<html>
<head>
  <title>Catholic Daily Readings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f8f9fa;
      --card: #ffffff;
      --text: #222;
      --accent: #8b0000;
    }

    body.dark {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f1f1f1;
      --accent: #d4af37;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      transition: 0.3s ease;
    }

    header {
      padding: 20px;
      text-align: center;
      font-family: 'Playfair Display', serif;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
    }

    .toggle {
      position: absolute;
      right: 20px;
      top: 20px;
      cursor: pointer;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid var(--accent);
      background: transparent;
      color: var(--accent);
    }

    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }

    .card {
      background: var(--card);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    h2 {
      font-family: 'Playfair Display', serif;
      color: var(--accent);
      margin-top: 0;
    }

    .verse {
      margin-bottom: 8px;
      font-size: 15px;
    }

    #datepicker {
      display: block;
      margin: 0 auto 20px auto;
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid var(--accent);
    }

    footer {
      text-align: center;
      padding: 30px 20px;
      font-size: 14px;
      opacity: 0.7;
      font-family: 'Playfair Display', serif;
    }

  </style>
</head>

<body>

<header>
  <h1>Daily Catholic Readings</h1>
  <button class="toggle" onclick="toggleMode()">Toggle Theme</button>
</header>

<div class="container">
  <input type="date" id="datepicker" />
</div>

<div class="container" id="content">
  Loading readings...
</div>

<footer>
  “Your word is a lamp to my feet and a light to my path.”  
  <br><br>
  Built with devotion ✝️
</footer>

<script>
function toggleMode() {
  document.body.classList.toggle("dark");
}

// Sample readings JSON
const readingsData = {
  "2026-02-15": {
    firstReading: "Jeremiah 17:5-8",
    psalm: "Psalm 1:1-4,6",
    secondReading: "1 Corinthians 15:12,16-20",
    gospel: "Luke 6:17,20-26"
  },
  "2026-02-16": {
    firstReading: "Genesis 1:1-19",
    psalm: "Psalm 104:1-5",
    secondReading: "Romans 8:18-25",
    gospel: "Matthew 5:1-12"
  }
};

// Load full Bible JSON
async function getBible() {
  const res = await fetch(
    "https://raw.githubusercontent.com/xxruyle/Bible-DouayRheims/master/EntireBible-DR.json"
  );
  return await res.json();
}

// Parse references like "Luke 6:17,20-26"
function parseReference(ref) {
  const parts = ref.split(" ");
  const book = parts.slice(0, parts.length - 1).join(" ");
  const versePart = parts[parts.length - 1];

  let chapter, start, end;

  if (versePart.includes(":")) {
    [chapter, verseRange] = versePart.split(":");
    if (verseRange.includes("-")) [start, end] = verseRange.split("-");
    else [start, end] = [verseRange, verseRange];
  } else {
    chapter = versePart;
    start = 1;
    end = 1;
  }

  return { book, chapter: parseInt(chapter), start: parseInt(start), end: parseInt(end) };
}

// Render a section card
function renderSection(title, reference, bible) {
  if (!reference) return `<div class="card"><h2>${title}</h2><em>No reading today.</em></div>`;

  const parsed = parseReference(reference);
  const chapterData = bible[parsed.book]?.[parsed.chapter];
  if (!chapterData) return `<div class="card"><h2>${title}</h2><em>Verse data not found.</em></div>`;

  let html = `<div class="card"><h2>${title}</h2><strong>${reference}</strong><br><br>`;
  for (let i = parsed.start; i <= parsed.end; i++) {
    html += `<div class="verse"><strong>${i}</strong> ${chapterData[i]}</div>`;
  }
  html += "</div>";
  return html;
}

async function display(dateKey) {
  try {
    const bible = await getBible();
    const key = dateKey || new Date().toISOString().split("T")[0];
    const todayReadings = readingsData[key] || readingsData["2026-02-15"];

    let html = "";
    html += renderSection("First Reading", todayReadings.firstReading, bible);
    html += renderSection("Responsorial Psalm", todayReadings.psalm, bible);
    html += renderSection("Second Reading", todayReadings.secondReading, bible);
    html += renderSection("Gospel", todayReadings.gospel, bible);

    document.getElementById("content").innerHTML = html;

  } catch (err) {
    document.getElementById("content").innerHTML =
      "Could not load readings. Please try again later.";
    console.error(err);
  }
}

// Initialize date picker
const datepicker = document.getElementById("datepicker");
const todayStr = new Date().toISOString().split("T")[0];
datepicker.value = todayStr;
datepicker.max = todayStr;

datepicker.addEventListener("change", () => {
  const selectedDate = datepicker.value;
  display(selectedDate);
});

// Display today's readings on load
display();

</script>

</body>
</html>
