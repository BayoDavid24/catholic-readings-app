<!DOCTYPE html>
<html>
<head>
  <title>Catholic Daily Readings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f8f9fa;
      --card: #ffffff;
      --text: #222;
      --accent: #8b0000;
    }

    body.dark {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f1f1f1;
      --accent: #d4af37;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      transition: 0.3s ease;
    }

    header {
      padding: 20px;
      text-align: center;
      font-family: 'Playfair Display', serif;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
    }

    .toggle {
      position: absolute;
      right: 20px;
      top: 20px;
      cursor: pointer;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid var(--accent);
      background: transparent;
      color: var(--accent);
    }

    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }

    .card {
      background: var(--card);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    h2 {
      font-family: 'Playfair Display', serif;
      color: var(--accent);
      margin-top: 0;
    }

    .verse {
      margin-bottom: 8px;
      font-size: 15px;
    }

    footer {
      text-align: center;
      padding: 30px 20px;
      font-size: 14px;
      opacity: 0.7;
      font-family: 'Playfair Display', serif;
    }

  </style>
</head>

<body>

<header>
  <h1>Daily Catholic Readings</h1>
  <button class="toggle" onclick="toggleMode()">Toggle Theme</button>
</header>

<div class="container" id="content">
  Loading readings...
</div>

<footer>
  “Your word is a lamp to my feet and a light to my path.”  
  <br><br>
  Built with devotion ✝️
</footer>

<script>
function toggleMode() {
  document.body.classList.toggle("dark");
}

async function getTodayReference() {
  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const day = String(today.getDate()).padStart(2, '0');
  const formatted = `${month}-${day}`;

  const url = `https://cpbjr.github.io/catholic-readings-api/readings/${year}/${formatted}.json`;

  const res = await fetch(url);
  return await res.json();
}

function parseReference(ref) {
  const parts = ref.split(" ");
  const book = parts.slice(0, parts.length - 1).join(" ");
  const versePart = parts[parts.length - 1];

  const [chapter, range] = versePart.split(":");
  const [start, end] = range.includes("-")
    ? range.split("-")
    : [range, range];

  return {
    book,
    chapter: parseInt(chapter),
    start: parseInt(start),
    end: parseInt(end)
  };
}

async function getBible() {
  const res = await fetch(
    "https://raw.githubusercontent.com/xxruyle/Bible-DouayRheims/master/EntireBible-DR.json"
  );
  return await res.json();
}

function renderSection(title, reference, bible) {
  if (!reference) return "";

  const parsed = parseReference(reference);
  const chapter = bible[parsed.book]?.[parsed.chapter];
  if (!chapter) return "";

  let html = `
    <div class="card">
      <h2>${title}</h2>
      <strong>${reference}</strong><br><br>
  `;

  for (let i = parsed.start; i <= parsed.end; i++) {
    html += `<div class="verse"><strong>${i}</strong> ${chapter[i]}</div>`;
  }

  html += "</div>";
  return html;
}

async function display() {
  try {
    const data = await getTodayReference();
    const bible = await getBible();

    let html = "";

    html += renderSection("First Reading", data.readings.firstReading, bible);
    html += renderSection("Responsorial Psalm", data.readings.psalm, bible);
    html += renderSection("Second Reading", data.readings.secondReading, bible);
    html += renderSection("Gospel", data.readings.gospel, bible);

    document.getElementById("content").innerHTML = html;

  } catch (err) {
    document.getElementById("content").innerHTML =
      "Could not load today's readings.";
  }
}

display();
</script>

</body>
</html>
